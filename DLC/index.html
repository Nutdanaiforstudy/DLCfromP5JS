<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DLC Editor — Auto-slice Spritesheet</title>

  <!-- p5.js + JSZip -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" defer></script>

  <link rel="stylesheet" href="style.css" />

  <!-- Lightweight style for the “open outside Wix” banner -->
  <style>
    #embedNotice {
      display:none; position:fixed; left:0; right:0; bottom:0; z-index:99999;
      background:#111827; color:#fff; padding:10px 14px;
      font:600 14px/1.2 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      box-shadow:0 -6px 18px rgba(0,0,0,.25);
    }
    #embedNotice a {
      display:inline-block; margin-left:10px; padding:8px 12px; border-radius:8px;
      background:#10b981; color:#0b1220; text-decoration:none; font-weight:800;
    }
  </style>
</head>
<body>
  <h1 class="title">DLC EDITOR</h1>
  <div class="sub">Auto-slice Spritesheet → sequential frames (p5.js)</div>

  <div class="container">
    <!-- Left -->
    <div class="card">
      <h3>Load spritesheet (drag & drop or file picker)</h3>
      <div class="row" style="margin-bottom:10px">
        <input id="fileInput" type="file" accept="image/*" style="display:none" />
        <button id="btnLoad" class="btn" type="button">Choose file</button>
        <button id="btnClear" class="btn secondary" type="button">Clear</button>
      </div>

      <div id="previewArea">
        <div id="previewInner">No image loaded<br /><small>Tip: drag & drop a PNG spritesheet here</small></div>
      </div>

      <h3 style="margin-top:18px">Auto-slice settings</h3>
      <div class="grid2" style="margin-bottom:10px">
        <div>
          <label for="prefix">filename prefix (eg. <code>idle</code>)</label>
          <!-- no trailing underscore to avoid double underscores -->
          <input id="prefix" type="text" value="frame">
        </div>
        <div>
          <label for="zeroPad">zero pad (eg. 3 → 001)</label>
          <input id="zeroPad" type="number" value="2" min="1">
        </div>
        <div>
          <label for="alphaThreshold">alpha threshold (0–255)</label>
          <input id="alphaThreshold" type="number" value="1" min="0" max="255">
        </div>
        <div>
          <label for="minWidth">min frame width (px)</label>
          <input id="minWidth" type="number" value="4" min="1">
        </div>
        <div>
          <label for="gapTol">max empty-gap allowed inside a frame (px)</label>
          <input id="gapTol" type="number" value="4" min="0">
        </div>
        <div>
          <label>&nbsp;</label>
          <div class="row">
            <button id="btnAuto" class="btn" type="button">Auto Slice</button>
            <button id="btnZip" class="btn" type="button">Auto Slice &amp; Download ZIP</button>
            <button id="btnToAssets" class="btn secondary" type="button">Auto Slice &amp; Add to Assets</button>
            <button id="btnDownloadCurrent" class="btn secondary" type="button">Download Current ZIP</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Right -->
    <div class="card">
      <h3>Manifest preview</h3>
      <pre id="manifestPreview">{}</pre>

      <h3 style="margin-top:18px">Sliced frames (preview)</h3>
      <div id="assetList"></div>

      <h3 style="margin-top:18px">Logs</h3>
      <div id="logs" aria-live="polite"></div>
    </div>
  </div>

  <!-- Confirm Download Popup -->
  <div id="downloadPopup" role="dialog" aria-modal="true" aria-labelledby="popupTitle">
    <div class="popup">
      <div id="popupTitle" class="popup-title">Ready to download</div>
      <div id="popupFilename" class="popup-filename"></div>
      <div class="popup-actions">
        <button id="confirmDownload" class="btn" type="button">Download</button>
        <button id="cancelPopup" class="btn secondary" type="button">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Appears only when embedded (e.g., Wix) -->
  <div id="embedNotice">
    Downloads are blocked inside this embedded view.
    <a id="openFullApp" href="https://nutdanaiforstudy.github.io/DLCfromP5JS/DLC/" target="_blank" rel="noopener">Open full app</a>
  </div>

  <!-- Detect embed & show notice; also warn if scripts are blocked -->
  <noscript>
    <div style="padding:12px;background:#fee2e2;color:#7f1d1d;text-align:center">
      JavaScript is disabled. The editor requires JavaScript.
    </div>
  </noscript>
  <script>
    (function () {
      var embedded = (window.top !== window.self);
      // Heuristic: show even if not strictly embedded but hosted on Wix
      var looksLikeWix = /wix|editor\.wix|wixsite/i.test(document.referrer) || /wix|wixsite/i.test(location.hostname);
      if (embedded || looksLikeWix) {
        var el = document.getElementById('embedNotice');
        if (el) el.style.display = 'block';
      }
    })();
  </script>

  <!-- Keep sketch.js last so p5 + JSZip are already loaded -->
  <script src="sketch.js" defer></script>
</body>
</html>
